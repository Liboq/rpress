<!DOCTYPE html>
<html lang="en" class="w-[100rem]">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>27</title>
    <link rel="stylesheet" href="../css/pico.min.css">
    <script src="https://giscus.app/client.js" data-repo="Liboq/rpress" data-repo-id="R_kgDOKmwZyA"
        data-category="Show and tell" data-category-id="DIC_kwDOKmwZyM4Cal6C" data-mapping="url" data-strict="0"
        data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom"
        data-theme="preferred_color_scheme" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async>
        </script>

</head>

<body>
    <nav>
        <ul>
            <li><a href="./index">é¦–é¡µ</a></li>
            <li>
                <details role="list">
                    <summary aria-haspopup="listbox" role="button">
                        æ–‡ç« 
                    </summary>
                    <ul role="listbox">
                        <li><a href="./tag">æ ‡ç­¾</a></li>
                        <li><a href="./category">ç±»å‹</a></li>
                    </ul>
                </details>
            </li>
            <li><a href="./about">å…³äº</a></li>
        </ul>
        <ul>
            <li><a href="./friend">å‹é“¾</a></li>
        </ul>
    </nav>
    <main id="container">
        <header>
            <h1 align="center" id="27">27</h1>
            <p align="center">
                <small>
                    <span>1979-05-27 |</span>
                </small>
                <a href="./category">ç”Ÿæ´»çç¢ |</a>
                
                <a href="./tag">æ‚è°ˆ</a>
                
            </p>
        </header>
        <article>
            <h2>èµ·å› </h2>
<p>åœ¨åšè‡ªå·±åšå®¢ç½‘ç«™çš„æ—¶å€™ï¼Œéœ€è¦åšä¸€ä¸ªæ ¹æ®é¡µé¢å†…å®¹æ¥æ˜¾ç¤ºæ ‡é¢˜å¯¼èˆªçš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ ¹æ® h1,h2,h3 æ¥å¯¼èˆªæ–‡ç« å†…å®¹ï¼Œæ–‡ç« å†…å®¹å˜åŒ–æ ‡é¢˜å¯¼èˆªçš„ menu çš„ active ç±»ä¹Ÿä¼šåˆ‡æ¢ï¼Œæ‰€ä»¥æˆ‘å°±æƒ³åšä¸€ä¸ªç›¸å…³çš„åº“ï¼Œæ–¹ä¾¿æœ‰ç›¸åŒéœ€æ±‚çš„æœ‹å‹ã€‚</p>
<h2>å¦‚ä½•å®ç°</h2>
<h3>è·å– menu</h3>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ ¹æ®æ‹¿åˆ°é¡µé¢çš„å†…å®¹ï¼Œæˆ‘æœ€å¼€å§‹æ˜¯åç«¯ç›´æ¥ä¼ æ–‡ç« å†…å®¹è¿‡æ¥ï¼Œæ‰€ä»¥æœ€å¼€å§‹ä¸€ç‰ˆåªé€šè¿‡ markdown çš„å†…å®¹æ¥æ¸²æŸ“æ ‡é¢˜å¯¼èˆªçš„ menuï¼Œåé¢ä¼˜åŒ–å¯ä»¥é€šè¿‡è·å–å…ƒç´ å†…å®¹æ¥æ¸²æŸ“ menuï¼Œä»£ç å¦‚ä¸‹</p>
<pre><code class="language-javascript">// æ ¹æ® props æ˜¯å¦ æ ¹æ® å…ƒç´ htmlå†…å®¹æ¥æ˜¾ç¤º
// props.container è¡¨ç¤º å…ƒç´ çš„æ ‡è¯† ä¾‹å¦‚â€˜class''id'
import MarkdownIt from &quot;markdown-it&quot;;
const transTextToHtml = () =&gt; {
  if (props.container) {
    html.value = contentText.value;
  } else {
    html.value = MarkdownIt().render(props.content);
  }
};
// è·å–menuçš„textæ•°ç»„
const getMenuText = () =&gt; {
  menuText.value = [];
  menu.value = html.value.match(regExe) || [];
  menuText.value.pop();
  menu.value.forEach((item: string) =&gt; {
    let s = &quot;&quot;;
    let index;
    let reg = new RegExp(/&lt;h\d(([\s\S])*?)&gt;/, &quot;g&quot;);
    s = item.replace(/&lt;\/h\d&gt;/, &quot;&quot;).replace(reg, &quot;&quot;);
    index = props.target.indexOf(item.split(&quot;&quot;)[1] + item.split(&quot;&quot;)[2]);
    if (index === -1) {
      return;
    }
    if (s.indexOf(&quot;&lt;/span&gt;&quot;) !== -1) {
      s = s.replace(&quot;&lt;/span&gt;&quot;, &quot;&quot;).replace(/&lt;span(([\s\S])*?)&gt;/g, &quot;&quot;); // è¿‡æ»¤å…¶ä»–æ ‡ç­¾
    }
    if (s.indexOf(&quot;&lt;/a&gt;&quot;) !== -1) {
      s = s.replace(&quot;&lt;/a&gt;&quot;, &quot;&quot;).replace(/&lt;a(([\s\S])*?)&gt;/g, &quot;&quot;); // è¿‡æ»¤å…¶ä»–æ ‡ç­¾
    }

    menuText.value.push({ text: s, level: index + 1 });
  });
};
</code></pre>
<h3>è·å–å®æ—¶å†…å®¹</h3>
<p>ç”±äºæœ€åˆçš„å†…å®¹æ˜¯åç«¯ä¼ è¿‡æ¥æ˜¯æ­»çš„ï¼Œæ‰€ä»¥å¼€å§‹å¹¶æ²¡æœ‰å¯¹å†…å®¹åšç›‘å¬ï¼Œåæ¥éœ€è¦é€‚é…ç¼–å†™ md å†…å®¹çš„æ—¶å€™å®æ—¶è·å– menuï¼Œæ‰€ä»¥å°±éœ€è¦ç›‘å¬å†…å®¹çš„å˜åŒ–æ¥å®æ—¶æ¸²æŸ“ menuï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="language-javascript">const contentText = computed(() =&gt; {
  if (!props.container) {
    return props.content;
  }
  return document.querySelector(props.container)!.innerHTML || &quot;&quot;;
});
if (props.isWatched) {
  watch(contentText, () =&gt; {
    transTextToHtml();
    getMenuText();
  });
}
</code></pre>
<h3>è·å– active çš„æ ‡é¢˜</h3>
<p>æ ¹æ®æ»šåŠ¨è·ç¦»è·å–æ˜¾ç¤ºåœ¨æœ€ä¸Šé¢çš„æ ‡é¢˜æ¥æ¸²æŸ“ active çš„ menuItem,åœ¨è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œæœ‰å¯èƒ½æ»šåŠ¨çš„ä¸æ˜¯ document è€Œæ˜¯æŸä¸ªå…ƒç´ ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œéœ€è¦åˆ¤æ–­ä¸€ä¸‹ï¼Œè·å–æ­£ç¡®çš„ offsetTop</p>
<pre><code class="language-javascript">const anchorClass = computed(() =&gt; {
  if (typeof props.classes === &quot;string&quot;) {
    return {
      &quot;anchor-container&quot;: true,
      &quot;anchor-list&quot;: !props.classes,
      [`${props.classes}`]: props.classes,
    };
  } else {
    return {
      &quot;anchor-container&quot;: true,
      ...props.classes,
    };
  }
});
const winScroll = throttle((e) =&gt; {
  let offsetTop
  if(props.scrollEL == &quot;document&quot;){
    offsetTop = 0
    scrollTop.value= document.documentElement.scrollTop || document.body.scrollTop
  }else{
    scrollTop.value = e.target.scrollTop
    offsetTop = e.target.offsetTop

  }
  for (let value of menuText.value) {
    if (document.getElementById(slugify(value.text))) {
      const entry = document.getElementById(slugify(value.text)) as HTMLElement;
      if (entry.offsetTop - 1-offsetTop &lt;= scrollTop.value) {
        indexActive.value = menuText.value.indexOf(value);
      }
    }
  }
}, 10);
const getActiveIndex = () =&gt; {
  let scrollel;
  if (props.scrollEL == &quot;document&quot;) {
    scrollel = document;
  } else {
    scrollel = document.querySelector(props.scrollEL);
  }
  scrollel!.addEventListener(&quot;scroll&quot;, winScroll, false);

};
</code></pre>
<h3>ç›‘å¬è·¯ç”±å˜åŒ–</h3>
<p>åœ¨ç»™ç»„ä»¶åº“åŠ ä¸Šæˆ‘è¿™ä¸ªåº“æ—¶å‘ç°è·¯ç”±ä¸€å‘ç”Ÿæ”¹å˜ï¼Œmenu çš„å†…å®¹æ²¡æœ‰å˜åŠ¨ï¼Œå‘ç°æ˜¯ç”±äºæ²¡æœ‰ç›‘å¬è·¯ç”±å˜åŒ–æ¥é‡æ–°æ¸²æŸ“ menuï¼Œæ‰€ä»¥åŠ ä¸Šäº†ä¸€ä¸ªç›‘å¬è·¯ç”±çš„åŠŸèƒ½,ç”±äºæµè§ˆå™¨æ²¡æœ‰å¯¹ pushState å’Œ replaceState äº‹ä»¶çš„ç›‘å¬ï¼Œæ‰€ä»¥åœ¨ç›‘å¬æµè§ˆå™¨å˜åŒ–çš„æ—¶å€™ï¼Œéœ€è¦ç»™äº‹ä»¶æ·»åŠ ç›‘å¬ï¼Œç„¶åæ ¹æ®æ˜¯å¦éœ€è¦ç›‘å¬è·¯ç”±çš„æ·»åŠ æµè§ˆå™¨çš„ç›‘å¬äº‹ä»¶</p>
<pre><code class="language-javascript">const pushState = window.history.pushState;
window.history.pushState = function (
  state: State,
  title: string,
  url?: string | null
): void {
  pushState.apply(window.history, [state, title, url]);
  const event: any = new Event(&quot;pushstate&quot;);
  event.state = state;
  event.title = title;
  event.url = url;
  window.dispatchEvent(event);
};

const replaceState = window.history.replaceState;
window.history.replaceState = function (
  state: State,
  title: string,
  url?: string | null
): void {
  replaceState.apply(window.history, [state, title, url]);
  const event: any = new Event(&quot;replacestate&quot;);
  event.state = state;
  event.title = title;
  event.url = url;
  window.dispatchEvent(event);
};
onMounted(() =&gt; {
  if (props.route) {
    window.addEventListener(&quot;pushstate&quot;, deferGetMenu);
    window.addEventListener(&quot;popstate&quot;, deferGetMenu);
  }
});
</code></pre>
<p>ä¸‹é¢æ˜¯æˆ‘çš„ github ä»“åº“<a href="https://github.com/Liboq/markdown-it-navbar">markdwon-it-navbar</a>,æ¬¢è¿ jym ç»™æˆ‘æ issuesğŸ¤“</p>

        </article>
    </main>
</body>

</html>